---
emoji: "ğŸš€"
title: "ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ"
date: 2025-01-04 00:00:00
update: 2025-01-04 00:00:00
tags:
  - Spring
  - JPA
series: "JPA ê¸°ë³¸"
---

ê°ì²´ì™€ í…Œì´ë¸” ì—°ê´€ê´€ê³„ì˜ ì°¨ì´ë¥¼ ì´í•´í•˜ê³  ì°¸ì¡°ì™€ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. ì•„ë˜ ìš©ì–´ëŠ” ì—°ê´€ê´€ê³„ ì„¤ëª…ì‹œ ë‚˜ì˜¤ëŠ” ìš©ì–´ì´ë‹ˆ ìˆ™ì§€í•˜ê³  ë„˜ì–´ê°€ë„ë¡ í•©ë‹ˆë‹¤.

- ë°©í–¥(Direction) : ë‹¨ë°©í–¥, ì–‘ë°©í–¥
- ë‹¤ì¤‘ì„±(Multiplicity) : ë‹¤ëŒ€ì¼(N:1), ì¼ëŒ€ë‹¤(1:N), ì¼ëŒ€ì¼(1:1), ë‹¤ëŒ€ë‹¤(N:M) ì´í•´
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner) : ê°ì²´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ê´€ë¦¬ ì£¼ì¸ì´ í•„ìš”

ì˜ˆì œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í†µí•´ ì—°ê´€ê´€ê³„ ë§¤í•‘ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

### ì˜ˆì œ ì‹œë‚˜ë¦¬ì˜¤

1. íšŒì›ê³¼ íŒ€ì´ ìˆë‹¤.
2. íšŒì›ì€ í•˜ë‚˜ì˜ íŒ€ì—ë§Œ ì†Œì†ë  ìˆ˜ ìˆë‹¤.
3. íšŒì›ê³¼ íŒ€ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ë‹¤.

ë¨¼ì € ê°ì²´ë¥¼ ì •ë§ ë‹¨ìˆœí•˜ê²Œ í…Œì´ë¸”ì— ë§ì¶° ì—°ê´€ê´€ê³„ ì—†ì´ ëª¨ë¸ë§ í•´ë³´ê² ìŠµë‹ˆë‹¤.

![image.png](images/img.png)

```java
@Entity
public class Member {
	@Id @GeneratedValue
	private Long id;
	
	@Column(Name = "USERNAME")
	private String name;
	
	@Column(Name = "TEAM_ID")
	private Long teamId;
	...
}
===============================================================
@Entity
public class Team {
	@Id @GeneratedValue
	private Long id;
	private String name;
}
===============================================================
// íŒ€ ì €ì¥
Team team = new Team();
team.setName("TeamA");
em.persist(team);

// íšŒì› ì €ì¥
Member member = new Member();
member.setName("member1");
member.setTeamId(team.getId());
em.persist(member)
===============================================================
// ì¡°íšŒ
Member findMember = em.find(Member.class, member.getId()); 
// ì—°ê´€ê´€ê³„ê°€ ì—†ìŒ
Team findTeam = em.find(Team.class, team.getId()); 
```

ë³´ì‹ ë°”ì™€ ê°™ì´ ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶° ë°ì´í„° ì¤‘ì‹¬ìœ¼ë¡œ ëª¨ë¸ë§í•˜ë©´ í˜‘ë ¥ ê´€ê³„ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ ì´ìœ ë¡œëŠ” **í…Œì´ë¸”**ì˜ ê²½ìš° **ì™¸ë˜ í‚¤**ë¡œ **ì¡°ì¸**ì„ ì‚¬ìš©í•˜ì—¬ ì—°ê´€ëœ í…Œì´ë¸”ì„ ì°¾ëŠ” ë°©ì‹ì´ì§€ë§Œ **ê°ì²´**ëŠ” **ì°¸ì¡°**ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ëœ ê°ì²´ë¥¼ ì°¾ìŠµë‹ˆë‹¤. ì´ë ‡ë“¯ í…Œì´ë¸”ê³¼ ê°ì²´ì˜ íŒ¨ëŸ¬ë‹¤ì„ì˜ ì°¨ì´ë¥¼ ì¸ì‹í•´ì•¼ í•©ë‹ˆë‹¤.

### ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

ì´ì œ ì—°ê´€ê´€ê³„ë¥¼ ì‚¬ìš©í•˜ì—¬ **ê°ì²´ì§€í–¥ìŠ¤ëŸ½ê²Œ** ëª¨ë¸ë§í•˜ë©´ MemberëŠ” ë” ì´ìƒ ì°¸ì¡° í‚¤ì¸ teamIdê°€ ì•„ë‹Œ Team ìì²´ë¥¼ ì°¸ì¡°í•˜ê³  ìˆìŠµë‹ˆë‹¤.

![image.png](images/img_1.png)

```java
@Entity
public class Member { 
  @Id @GeneratedValue
  private Long id;
  
  @Column(name = "USERNAME")
  private String name;
  private int age;
  
//    @Column(name = "TEAM_ID")
//    private Long teamId;

  @ManyToOne
  @JoinColumn(name = "TEAM_ID")
  private Team team;
  ...
}
===============================================================
//íŒ€ ì €ì¥
Team team = new Team();
team.setName("TeamA");
em.persist(team);
//íšŒì› ì €ì¥
Member member = new Member();
member.setName("member1");
member.setTeam(team); //ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ ì„¤ì •, ì°¸ì¡° ì €ì¥
em.persist(member)

===============================================================
 //ì¡°íšŒ
Member findMember = em.find(Member.class, member.getId()); 
//ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ ì¡°íšŒ
Team findTeam = findMember.getTeam();

===============================================================
 // ìƒˆë¡œìš´ íŒ€B
Team teamB = new Team();
teamB.setName("TeamB");
em.persist(teamB);
// íšŒì›1ì— ìƒˆë¡œìš´ íŒ€B ì„¤ì •
member.setTeam(teamB)
```

JoinColumn ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸”ê³¼ ë§¤í•‘ëœ ê·¸ë¦¼ì„ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![image.png](images/img_2.png)

### ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ì˜ ê²½ìš° ì¡°ê¸ˆì˜ ì´í•´ë¡œë„ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ì´í•´í•˜ë©´ ì–´ë µì§€ ì•Šì§€ë§Œ jpaê³„ì˜ í¬ì¸í„°ë¼ê³  í• ë§Œí¼ ë§ì´ í—·ê°ˆë ¤í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.

Teamì€ Memberë¥¼ ëª¨ë¥´ëŠ” ë‹¨ë°©í–¥ê³¼ëŠ” ë‹¬ë¦¬ Team ë˜í•œ membersë¥¼ ì•Œê³  ìˆëŠ” ì–‘ë°©í–¥ ê´€ê³„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.

![image.png](images/img_3.png)

```java
// Member Entityì˜ ë³€í™”ëŠ” ì—†ìŒ
@Entity
public class Member { 
  @Id @GeneratedValue
  private Long id;
  
  @Column(name = "USERNAME")
  private String name;
  private int age;
  
  @ManyToOne
  @JoinColumn(name = "TEAM_ID")
  private Team team;
  â€¦ 
}
// members ì»¬ë ‰ì…˜ ì¶”ê°€
@Entity
public class Team {
  @Id @GeneratedValue
  private Long id;
  
  private String name;
  
  @OneToMany(mappedBy = "team") // Member Entityì˜ "team"ìœ¼ë¡œ ë§¤í•‘ë˜ì–´ ìˆë‹¤
  List<Member> members = new ArrayList<Member>();
  â€¦ 
} 
===============================================================
Team findTeam = em.find(Team.class, team.getId());  //ì¡°íšŒ
int memberSize = findTeam.getMembers().size(); //ì—­ë°©í–¥ ì¡°íšŒ

```

ì—¬ê¸°ì„œ Teamë„ Memberë¥¼ ì°¸ì¡°í•˜ë ¤ ì‚¬ìš©í•œ mappedByì— ëŒ€í•´ ì •í™•í•˜ê²Œ ì§šê³  ë„˜ì–´ê°€ì•¼ í•©ë‹ˆë‹¤. mappedByëŠ” JPAì˜ ë©˜íƒˆë¶•ê´´ê¸‰ ë‚œì´ë„ë¡œ ì²˜ìŒì— ì´í•´í•˜ê¸° ì¢€ ì–´ë ¤ìš°ë©° **ê°ì²´**ì™€ **í…Œì´ë¸”**ê°„ì— **ì—°ê´€ê´€ê³„**ë¥¼ ë§ºëŠ” **ì°¨ì´**ë¥¼ ë°˜ë“œì‹œ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.

ê°ì²´ì™€ í…Œì´ë¸”ì´ ê´€ê³„ë¥¼ ë§ºëŠ” ì°¨ì´ë¥¼ ì‰½ê²Œ í’€ì–´ë³´ê² ìŠµë‹ˆë‹¤.

ë¨¼ì € ê°ì²´ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì—°ê´€ê´€ê³„ë¥¼ ë§ºìŠµë‹ˆë‹¤.

- Member â†’ Team (ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„)
- Team â†’ Member (ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„)

**ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„**ë¼ ë¶€ë¥´ì§€ë§Œ ì‚¬ì‹¤ì€ ê·¸ëƒ¥ ì„œë¡œ ì—°ê²°ë˜ì–´ ìˆëŠ” **ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ê°€ ë‘ ê°œì¸ ê´€ê³„**ì…ë‹ˆë‹¤.  ê°„ë‹¨í•œ ì½”ë“œë¡œ ë³´ë©´ ì´í•´ê°€ ë”ìš± ì‰½ìŠµë‹ˆë‹¤.

```java
class A {
	B b;
}

class B {
	A a;
}

a.getB(); // A -> Bì˜ ì—°ê´€ê´€ê³„
b.getA(); // B -> Aì˜ ì—°ê´€ê´€ê³„
```

í…Œì´ë¸”ì€ ì–´ë–»ê²Œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºì„ê¹Œìš”?

- Member â†” Team (ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„)

ê°ì²´ì˜ ì—°ê´€ê´€ê³„ì™€ëŠ” ë‹¬ë¦¬ ì–‘ë°©í–¥ìœ¼ë¡œ ì—´ë ¤ìˆëŠ” ì—°ê´€ê´€ê³„ í•˜ë‚˜ê°€ ì „ë¶€ì…ë‹ˆë‹¤. ì—°ê´€ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê·¸ë¦¼ì„ ë‹¤ì‹œ ë³´ì‹œë©´ ê°ì²´ëŠ” MemberëŠ” Teamì„, Teamì€ Memberë¥¼ ì„œë¡œ ì°¸ì¡°í•˜ê³  ìˆëŠ” ë‘ ê°œì˜ ì—°ê´€ê´€ê³„ê°€ ìˆê³ . í…Œì´ë¸”ì€ MEMBER.TEAM_ID **ì™¸ë˜ í‚¤ í•˜ë‚˜**ë¡œ ì–‘ë°©í–¥ ëª¨ë‘ JOINí•˜ì—¬ ì¡°íšŒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í•œ ê°œì˜ ì—°ê´€ê´€ê³„ê°€ ìˆìŠµë‹ˆë‹¤.

![image.png](images/img_4.png)

```sql
// ì™¸ë˜í‚¤ì¸ TEAM_ID í•˜ë‚˜ë¡œ ëª¨ë‘ ë‹¤ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

SELECT * 
FROM MEMBER M
JOIN TEAM T ON M.TEAM_ID = T.TEAM_ID 
 
SELECT * 
FROM TEAM T
JOIN MEMBER M ON T.TEAM_ID = M.TEAM_ID
```

ì´ ì°¨ì´ë¥¼ ì´í•´í•´ì•¼ í•˜ëŠ” ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

ë§Œì•½ Aë¼ëŠ” Memberì˜ Teamì„ ë°”ê¿”ì£¼ê³  ì‹¶ì„ ë•Œ í…Œì´ë¸”ì€ ê·¸ì € MEMBER.TEAM_ID ì™¸ë˜í‚¤ë§Œ ì—…ë°ì´íŠ¸í•˜ë©´ ë©ë‹ˆë‹¤.  í•˜ì§€ë§Œ ê°ì²´ì—ì„œëŠ” Memberê°€ ì°¸ì¡°í•˜ê³  ìˆëŠ” Teamì„ ì—…ë°ì´íŠ¸ í•´ë„ ë˜ê³  Teamì´ ì°¸ì¡°í•˜ê³  ìˆëŠ” Memberì˜ Teamì„ ì—…ë°ì´íŠ¸ í•´ë„ ë©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ë”œë ˆë§ˆë¡œ ì¸í•´ JPAì—ì„œëŠ” ë‘˜ ì¤‘ í•˜ë‚˜ë¡œë§Œ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ë£°ì´ ìƒê²¼ìŠµë‹ˆë‹¤. ì´ë¥¼ **ì–‘ë°©í–¥ ê´€ê³„ì—ì„œì˜ ì£¼ì¸**ì´ë¼ í‘œí˜„í•©ë‹ˆë‹¤.

ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ë§ºì„ ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë§¤í•‘ ê·œì¹™ì´ ìˆìŠµë‹ˆë‹¤.

- ê°ì²´ëŠ” ë‘ ê´€ê³„ ì¤‘ í•˜ë‚˜ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì§€ì •
- **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬**(ë“±ë¡, ìˆ˜ì •)
- **ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥**
- ì£¼ì¸ì€ mappedBy ì†ì„± ì‚¬ìš© X
- ì£¼ì¸ì´ ì•„ë‹ˆë©´ mappedBy ì†ì„±ìœ¼ë¡œ ì£¼ì¸ ì§€ì •

![image.png](images/img_5.png)

ì´ëŸ¬í•œ ì°¨ì´ë‚˜ ê°œë…ì„ ì´í•´í•˜ì§€ ëª»í•˜ê³  ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ì‚¬ìš©ì‹œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê°’ì„ ì…ë ¥í•˜ì§€ ì•ŠëŠ” ì‹¤ìˆ˜ë“¤ì„ ë§ì´ í•©ë‹ˆë‹¤.

```sql
Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setName("member1");

// ì—­ë°©í–¥(ì£¼ì¸ì´ ì•„ë‹Œ ë°©í–¥)ë§Œ ì—°ê´€ê´€ê³„ ì„¤ì •
team.getMembers().add(member);

em.persist(member);

// ì‹¤í–‰ê²°ê³¼
ID : 1
USERNAME : member1
TEAM_ID : null

===============================================================

Team team = new Team();
team.setName("TeamA");
em.persist(team);

Member member = new Member();
member.setName("member1");

team.getMembers().add(member); 

member.setTeam(team); // ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê°’ ì„¤ì • 
em.persist(member)

// ì‹¤í–‰ê²°ê³¼
ID : 1
USERNAME : member1
TEAM_ID : 2
```

### ì–‘ë°©í–¥ ë§¤í•‘ ì •ë¦¬

- ë‹¨ë°©í–¥ ë§¤í•‘ë§Œìœ¼ë¡œë„ ì´ë¯¸ ì—°ê´€ê´€ê³„ ë§¤í•‘ì€ ì™„ë£Œ
- ì–‘ë°©í–¥ ë§¤í•‘ì€ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ì¡°íšŒ(ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰) ê¸°ëŠ¥ì´ ì¶”ê°€ëœ ê²ƒ ë¿ì„
- JPQLì—ì„œ ì—­ë°©í–¥ìœ¼ë¡œ íƒìƒ‰í•  ì¼ì´ ë§ìŒ
- ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì˜ í•˜ê³  ì–‘ë°©í–¥ì€ í•„ìš”í•  ë•Œ ì¶”ê°€í•´ë„ ë¨

  (í…Œì´ë¸”ì— ì˜í–¥ X)

- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ ì„ íƒì‹œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì•„ë‹Œ `ì™¸ë˜ í‚¤ì˜ ìœ„ì¹˜`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •í•´ì•¼í•¨
 
**ì´ ë§í¬ë¥¼ í†µí•´ êµ¬ë§¤í•˜ì‹œë©´ ì œê°€ ìˆ˜ìµì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”. ğŸ¤—**

https://inf.run/ZVGV8